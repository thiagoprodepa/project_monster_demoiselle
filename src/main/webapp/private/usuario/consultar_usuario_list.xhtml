<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/WEB-INF/templates/default.xhtml">
	<ui:define name="titulo">Pesquisa de Usuário</ui:define>

	<ui:define name="caminho">
		<h:graphicImage styleClass="pic" title="Navegação" value="/images/icons/application_form_magnify.png" />
		<h:outputText value="Usuário &#187; Pesquisa" />
	</ui:define>

	<ui:define name="conteudo">
		<a4j:form id="form-pesquisa-usuario">
			<h:panelGrid columns="2" styleClass="grid"
				columnClasses="search-inputs, search-controls">
				<h:panelGrid id="form-pesquisa-inputs" columns="2"
					columnClasses="column-label, column-control">
					
					<h:outputText value="Aplicação: *" />
					<h:selectOneMenu id="usuario-aplicacao" value="#{buscaUsuarioDto.aplicacao}"
						required="true" requiredMessage="É necessário informar a aplicação.">
						<s:selectItems id="usuario-aplicacao-item" value="#{aplicacoesAtivo}"
							var="aplicacao" label="#{aplicacao.descricao}" noSelectionLabel="" />
						<s:convertEntity />
					</h:selectOneMenu>
					
					<h:outputLabel value="Nome: " for="usuario-nome" />
					<h:inputText id="usuario-nome" value="#{buscaUsuarioDto.nome}"
						size="50" maxlength="255" />
				
					<h:outputLabel value="Documento: " for="usuario-panel-documento" />
					<h:panelGroup id="usuario-panel-documento">
						<h:selectOneMenu id="usuario-tipo-documento" value="#{buscaUsuarioDto.tipoDocumento}" >
							<s:selectItems value="#{tiposDocumento}" id="usuario-tipo-documento-item"
								var="doc" label="#{doc.descricao}" noSelectionLabel="--- Todos ---" />
							<a4j:support event="onchange" ajaxSingle="true" reRender="panel-usuario-documento"
								oncomplete="document.getElementById('form-pesquisa-usuario:usuario-documento').focus();" />
							<s:convertEnum />
						</h:selectOneMenu>
						<h:panelGroup id="panel-usuario-documento">
							<h:inputText id="usuario-documento" value="#{buscaUsuarioDto.numeroDocumento}" />
							<rich:jQuery selector="#usuario-documento" query="mask('999.999.999-99')" rendered="#{buscaUsuarioDto.tipoDocumento.codigo eq '0'}" timing="immediate" />
							<rich:jQuery selector="#usuario-documento" query="setMask()" rendered="#{buscaUsuarioDto.tipoDocumento.codigo eq '1'}" timing="immediate"/>
						</h:panelGroup>
					</h:panelGroup>

					<h:outputLabel value="Órgão: " for="usuario-orgao" />
					<h:selectOneMenu id="usuario-orgao" value="#{buscaUsuarioDto.orgao}">
						<s:selectItems value="#{orgaosAtivoCA}"
							var="o" label="#{o.pessoa.sigla}"
							noSelectionLabel="--- Todos ---" />
						<s:convertEntity />
					</h:selectOneMenu>
				</h:panelGrid>

				<h:panelGroup id="form-pesquisa-controls" layout="block">
					<a4j:commandLink id="botao-pesquisar" action="#{usuarioAction.buscar}" reRender="resultados">
						<h:panelGroup layout="block" styleClass="primary-button">
							<h:graphicImage value="/images/icons/magnifier.png" />
							<h:outputText value="Pesquisar" />
						</h:panelGroup>
					</a4j:commandLink>
				</h:panelGroup>
			</h:panelGrid>

			<rich:hotKey key="return" selector="#form-pesquisa-inputs"
				handler="document.getElementById('form-pesquisa-usuario:botao-pesquisar').click();" />
		</a4j:form>
	</ui:define>
	
	<ui:define name="complemento">
		<!-- Resultado da pesquisa -->
		<h:form id="form-lista-perfil">
			<h:panelGroup id="resultados">
				<h:panelGroup rendered="#{usuarios.rowCount == 0}">
					<h:outputText value="Nenhum resultado encontrado." />
				</h:panelGroup>

				<rich:dataTable id="usuarios" value="#{usuarios}" var="u"
					rows="10" rowKeyVar="indice" cellpadding="0" cellspacing="0"
					width="100%" border="0" rendered="#{usuarios.rowCount > 0}">
					<rich:column id="column-indice" style="text-align: right;" width="1px">
						<f:facet name="header" />
						<h:outputText value="#{(indice + 1)}"/>
					</rich:column>
					
					<rich:column id="column-nome" style="text-align: left;" sortBy="#{u.nome}">
						<f:facet name="header">
							<h:outputText value="Nome" />
						</f:facet>
						<h:outputText value="#{u.nome}" />
					</rich:column>
					
					<rich:column id="column-login" style="text-align: center;"
						sortBy="#{u.login}">
						<f:facet name="header">
							<h:outputText value="Login" />
						</f:facet>
						<h:outputText value="#{u.login}" />
					</rich:column>
					
					<rich:column id="column-email" style="text-align: center;"
						sortBy="#{u.email}">
						<f:facet name="header">
							<h:outputText value="E-mail" />
						</f:facet>
						<h:outputText value="#{u.email}" />
					</rich:column>
					
					<rich:column id="column-orgao" style="text-align: center;"
						sortBy="#{u.orgao}">
						<f:facet name="header">
							<h:outputText value="Órgão" />
						</f:facet>
						<h:outputText value="#{u.orgao.pessoa.sigla}" />
					</rich:column>
		
					<rich:column id="column-perfis" style="text-align: center;">
						<f:facet name="header">
							<h:outputText value="Perfis"/>
						</f:facet>
						<h:outputText value="#{u.perfis[0].descricao} (#{u.perfis[0].aplicacao})" />
						<h:outputText value="[+]" style="color: #3A5FCD;" rendered="#{u.perfis[1] != null}" />
						<rich:toolTip direction="top-right" styleClass="tooltip" rendered="#{u.perfis[1] != null}">
							<rich:dataList var="p" value="#{u.perfis}" styleClass="listInt">
								<h:outputText value="#{p.descricao} - #{p.aplicacao}" style="font-weight: bold;" />
							</rich:dataList>
						</rich:toolTip>
					</rich:column>			
		
					<f:facet name="footer">
						<rich:datascroller id="paginador" for="usuarios" maxPages="10"
							stepControls="hide" renderIfSinglePage="false" />
					</f:facet>
				</rich:dataTable>
			</h:panelGroup>
		</h:form>

        <script language="JavaScript">
        	function formFocus() {
        		document.getElementById('form-pesquisa-usuario:usuario-aplicacao').focus();
			}
        	formFocus();
        </script>
	</ui:define>
</ui:composition>